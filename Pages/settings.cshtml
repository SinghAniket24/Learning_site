@page
@model Learning_site.Pages.settingsModel
@using Microsoft.AspNetCore.Authentication
@using Microsoft.AspNetCore.Authentication.Cookies
@using Microsoft.AspNetCore.Authentication.OpenIdConnect
@using System.Security.Claims
@{
    ViewData["Title"] = "Settings";

   
    var userEmail = User.Identity?.IsAuthenticated == true ? User.FindFirst(ClaimTypes.Email)?.Value : "";
    var profilePic = User.Identity?.IsAuthenticated == true ? User.FindFirst("picture")?.Value : "";
}

<div class="container my-5">
    <div class="card shadow-lg border-0 rounded-4 overflow-hidden">
        <div class="bg-primary bg-gradient text-white text-center p-4">
            <h2 class="fw-bold mb-0">⚙ Settings</h2>
        </div>

        <div class="card-body p-4">
            <div class="card mb-4 shadow-sm border-0 rounded-3">
                <div class="card-body bg-white d-flex align-items-center">
                    @if (User.Identity?.IsAuthenticated == true)
                    {
                        @if (!string.IsNullOrEmpty(profilePic))
                        {
                            <img src="@profilePic" alt="Profile Picture" class="rounded-circle me-3 border" style="width:70px; height:70px; object-fit:cover;" />
                        }
                        <div>
                         
                            <p class="mb-0"><strong>Email:</strong> @userEmail</p>
                        </div>
                    }
                    else
                    {
                        <p class="text-muted mb-0">Not logged in</p>
                    }
                </div>
            </div>

            <div class="card mb-4 shadow-sm border-0 rounded-3">
                <div class="card-body">
                    <h5 class="fw-semibold mb-3 text-primary">🎨 Theme</h5>
                    <button id="themeButton" onclick="toggleTheme()" class="btn btn-primary">
                        Change Theme
                    </button>
                    <span id="currentTheme" class="badge bg-secondary ms-2">Light</span>
                    <small class="text-muted d-block mt-2">
                        Click to cycle through Light, Dark, and Gradient themes
                    </small>
                </div>
            </div>

            
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/theme.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('selectedTheme') || 'light';
            updateThemeBadge(savedTheme);
        });

        const originalToggleTheme = window.toggleTheme;
        window.toggleTheme = function () {
            originalToggleTheme();
            const current = localStorage.getItem('selectedTheme') || 'light';
            updateThemeBadge(current);
        };

        function updateThemeBadge(theme) {
            const badge = document.getElementById('currentTheme');
            if (!badge) return;
            badge.textContent = theme.charAt(0).toUpperCase() + theme.slice(1);
            badge.className = 'badge ms-2 ' +
                (theme === 'light' ? 'bg-secondary' :
                    theme === 'dark' ? 'bg-dark text-white' :
                        'bg-gradient text-white');
        }
    </script>
}
